# การบ้าน: MLflow Prompt Optimization with Reflection Pattern

## Toxicity Level Classification สำหรับระบบ Content Moderation

### โจทย์

นักศึกษาต้องสร้างระบบจำแนกระดับความรุนแรงของข้อความในกระทู้ออนไลน์ภาษาไทย โดยจำแนกเป็น 4 ระดับ:

- **safe** — ปลอดภัย ไม่มีเนื้อหาไม่เหมาะสม
- **mild** — มีการใช้คำไม่สุภาพเล็กน้อย แต่ไม่ได้มุ่งร้ายต่อบุคคล
- **moderate** — มีการดูถูก เสียดสี หรือกดดันบุคคล/กลุ่มคนอย่างชัดเจน
- **severe** — มีการข่มขู่ ยุยง สร้างความเกลียดชัง หรือเรียกร้องให้ใช้ความรุนแรง

### สิ่งที่ต้องทำ

1. สร้าง Prompt v1 แบบพื้นฐานและ Register ลง MLflow
2. ใช้ Test Dataset 15 ข้อที่กำหนดให้
3. ทดสอบ Prompt v1 และบันทึก Accuracy
4. ใช้ Reflection Pattern ปรับปรุง Prompt **อย่างน้อย 3 รอบ หรือจนกว่าจะได้ Accuracy = 100%**
5. Register ทุก Version ลง MLflow พร้อม commit message
6. Log ผลลัพธ์ลง MLflow Experiment
7. เปรียบเทียบและวิเคราะห์ผลลัพธ์

### Test Dataset (15 ข้อ)

```python
TEST_DATA_TOXICITY = [
    # safe ที่ดูเหมือนรุนแรง
    {"text": "ฆ่าเวลาไม่รู้จะทำอะไร เปิดดูซีรีส์ไปเรื่อยๆ", "expected": "safe"},
    {"text": "เกมนี้โหดมาก ด่านสุดท้ายยากจนอยากทุบจอ", "expected": "safe"},
    {"text": "เผาขนหมูไม่ดี เหม็นไหม้ทั้งบ้าน", "expected": "safe"},

    # mild ที่อาจดูเหมือน safe หรือ moderate
    {"text": "คนขับแท็กซี่โคตรเซ็งเลย ขับวนอ้อมตั้งสามรอบ", "expected": "mild"},
    {"text": "ไอ้เวรเอ้ย ลืมกุญแจไว้ในรถอีกแล้ว", "expected": "mild"},
    {"text": "หนังเรื่องนี้ห่วยแตกจริงๆ เสียเงินฟรี", "expected": "mild"},

    # moderate ที่อาจดูเหมือน mild
    {"text": "คนแบบนี้ไม่สมควรมีตำแหน่ง โง่จนน่าสมเพช ลาออกไปเถอะ", "expected": "moderate"},
    {"text": "พวกบ้านนอกอย่ามาออกความเห็น ไม่รู้เรื่องอะไรสักอย่าง", "expected": "moderate"},
    {"text": "แอดมินเพจนี้ เอาแต่ลบคอมเมนต์คนเห็นต่าง เผด็จการชัดๆ", "expected": "moderate"},

    # severe ที่ใช้ภาษาอ้อม
    {"text": "ถ้าเจอตัวจริงนี่ไม่รับรองความปลอดภัยนะ จำไว้ด้วย", "expected": "severe"},
    {"text": "ไล่พวกนี้ออกจากประเทศไปเลย ไม่ใช่คนเหมือนกัน", "expected": "severe"},
    {"text": "ใครมีข้อมูลส่วนตัวมันมั่ง เดี๋ยวจัดการเอง", "expected": "severe"},

    # กรณีกำกวมสูง
    {"text": "นักการเมืองคนนี้ควรโดนประชาชนสั่งสอน ด้วยการไม่เลือกสมัยหน้า", "expected": "safe"},
    {"text": "ถ้าปล่อยให้พวกนี้ทำต่อ บ้านเมืองพังแน่ๆ ต้องรวมตัวกันลุกขึ้นสู้", "expected": "moderate"},
    {"text": "แม่งบ้าไปแล้ว 555 กูรักมึงว่ะเพื่อน", "expected": "safe"},
]
```

### ความยากที่ต้องจัดการ
- สำนวนไทยที่ดูรุนแรงแต่ไม่ได้มุ่งร้าย (ฆ่าเวลา, โคตร, แม่ง ในบริบทเพื่อน)
- การข่มขู่แบบอ้อมค้อมที่ไม่ใช้คำหยาบโดยตรง
- การแยก mild (ด่าสิ่งของ/สถานการณ์) กับ moderate (ดูถูกบุคคล/กลุ่มคน)
- ข้อความที่มีคำรุนแรงแต่ใช้ในบริบทเพื่อน/ตลก

