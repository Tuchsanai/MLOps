# üß™ Prompt Engineering Lab with Gemini API

## üìö Lab Overview & Learning Objectives

Lab ‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏ù‡∏∂‡∏Å‡∏ù‡∏ô‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Prompt Engineering ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏ú‡πà‡∏≤‡∏ô Gemini API ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö Evaluation ‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô

---

```python
#%% [markdown]
# # üß™ Prompt Engineering Advanced Lab with Gemini API
# 
# ## üìã Lab Description
# Lab ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Prompt Engineering ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏ó‡∏±‡πâ‡∏á 8 ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ:
# 1. Few-shot Prompting
# 2. Chain-of-Thought (CoT)
# 3. Self-consistency Chain-of-Thought
# 4. Prompt Chaining
# 5. Reflection
# 6. Tree-of-Thought (ToT)
# 7. Self-feedback
# 8. Self-critique
# 
# ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö Evaluation:
# - LLM-as-a-Judge
# - Reference-free Evaluation
# 
# ## üéØ Learning Outcomes
# - ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Prompt Engineering ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á
# - ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ
# - ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û Output ‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

#%% [markdown]
# ---
# # üîß Part 0: Environment Setup
# ---

#%%
# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Library ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
# !pip install google-genai pandas numpy

#%%
# Import Libraries
from google import genai
from google.genai import types
import json
import time
import re
from typing import List, Dict, Any

#%%
# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î API Key ‡πÅ‡∏•‡∏∞ Model
API_KEY = "YOUR_API_KEY_HERE"  # ‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
MODEL_NAME = "gemini-2.0-flash"

# ‡∏™‡∏£‡πâ‡∏≤‡∏á Client
client = genai.Client(api_key=API_KEY)

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Connection
response = client.models.generate_content(
    model=MODEL_NAME,
    contents="‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ! ‡∏ï‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß"
)
print("‚úÖ Connection Test:", response.text)

#%% [markdown]
# ---
# # üìò Part 1: Few-shot Prompting
# **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‚≠ê (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)**
# 
# ---
# ## üìñ ‡∏ó‡∏§‡∏©‡∏é‡∏µ
# **Few-shot Prompting** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (examples) ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô prompt 
# ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ LLM ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞ pattern ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
# 
# ### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
# - **Zero-shot**: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
# - **One-shot**: ‡∏°‡∏µ 1 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
# - **Few-shot**: ‡∏°‡∏µ 2-5 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
# 
# ### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ:
# - ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ output format ‡πÄ‡∏â‡∏û‡∏≤‡∏∞
# - Task ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠
# - ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° pattern

#%%
# === Lab 1.1: Zero-shot vs Few-shot Comparison ===
# Task: ‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å (Sentiment Analysis) ‡∏Ç‡∏≠‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£

# Zero-shot
zero_shot_prompt = """
‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô: ‡∏ö‡∏ß‡∏Å, ‡∏•‡∏ö, ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏•‡∏≤‡∏á

‡∏£‡∏µ‡∏ß‡∏¥‡∏ß: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡∏£‡∏≠‡∏ô‡∏≤‡∏ô‡πÑ‡∏õ‡∏´‡∏ô‡πà‡∏≠‡∏¢"
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å:
"""

response_zero = client.models.generate_content(
    model=MODEL_NAME,
    contents=zero_shot_prompt
)
print("üîπ Zero-shot Result:")
print(response_zero.text)

#%%
# Few-shot (3 examples)
few_shot_prompt = """
‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô: ‡∏ö‡∏ß‡∏Å, ‡∏•‡∏ö, ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏•‡∏≤‡∏á

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 1:
‡∏£‡∏µ‡∏ß‡∏¥‡∏ß: "‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏°‡∏≤‡∏Å‡∏Ñ‡πà‡∏∞ ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° ‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏µ‡∏Å‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô!"
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å: ‡∏ö‡∏ß‡∏Å

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 2:
‡∏£‡∏µ‡∏ß‡∏¥‡∏ß: "‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏°‡∏≤‡∏Å ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏¢‡πá‡∏ô ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏∏‡∏†‡∏≤‡∏û"
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å: ‡∏•‡∏ö

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 3:
‡∏£‡∏µ‡∏ß‡∏¥‡∏ß: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡πá‡πÇ‡∏≠‡πÄ‡∏Ñ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏≠‡∏∞‡πÑ‡∏£"
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å: ‡∏Å‡∏•‡∏≤‡∏á

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ô‡∏µ‡πâ:
‡∏£‡∏µ‡∏ß‡∏¥‡∏ß: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡∏£‡∏≠‡∏ô‡∏≤‡∏ô‡πÑ‡∏õ‡∏´‡∏ô‡πà‡∏≠‡∏¢"
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å:
"""

response_few = client.models.generate_content(
    model=MODEL_NAME,
    contents=few_shot_prompt
)
print("üîπ Few-shot Result:")
print(response_few.text)

#%%
# === Lab 1.2: Few-shot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Data Transformation ===
# Task: ‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô JSON format

few_shot_address = """
‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô JSON format

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 1:
Input: "123/45 ‡∏ã‡∏≠‡∏¢‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó 21 ‡∏ñ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó ‡πÅ‡∏Ç‡∏ß‡∏á‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ ‡πÄ‡∏Ç‡∏ï‡∏ß‡∏±‡∏í‡∏ô‡∏≤ ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10110"
Output: {
  "house_number": "123/45",
  "soi": "‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó 21",
  "road": "‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó",
  "subdistrict": "‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢‡πÄ‡∏´‡∏ô‡∏∑‡∏≠",
  "district": "‡∏ß‡∏±‡∏í‡∏ô‡∏≤",
  "province": "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£",
  "postal_code": "10110"
}

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 2:
Input: "89 ‡∏´‡∏°‡∏π‡πà 5 ‡∏ï‡∏≥‡∏ö‡∏•‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£ 10540"
Output: {
  "house_number": "89",
  "moo": "5",
  "subdistrict": "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ",
  "district": "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ",
  "province": "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£",
  "postal_code": "10540"
}

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏µ‡πâ:
Input: "456/7 ‡∏ñ‡∏ô‡∏ô‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ‡∏ï‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏Ç‡∏ß‡∏á‡∏ö‡∏≤‡∏á‡∏Å‡∏∞‡∏õ‡∏¥ ‡πÄ‡∏Ç‡∏ï‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10310"
Output:
"""

response = client.models.generate_content(
    model=MODEL_NAME,
    contents=few_shot_address
)
print("üîπ Address Transformation Result:")
print(response.text)

#%% [markdown]
# ### üìù ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î 1: Few-shot Prompting
# 
# **‡πÇ‡∏à‡∏ó‡∏¢‡πå**: ‡∏™‡∏£‡πâ‡∏≤‡∏á Few-shot prompt ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏õ‡πá‡∏ô SKU code
# - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß ‡πÑ‡∏ã‡∏™‡πå L" ‚Üí "TSH-WHT-L"
# - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
# - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö input ‡πÉ‡∏´‡∏°‡πà

#%%
# === ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î 1: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Code ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ===

# TODO: ‡∏™‡∏£‡πâ‡∏≤‡∏á few-shot prompt ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SKU generation
few_shot_sku_prompt = """
# ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô prompt ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà


"""

# response = client.models.generate_content(
#     model=MODEL_NAME,
#     contents=few_shot_sku_prompt
# )
# print(response.text)

#%% [markdown]
# ---
# # üìò Part 2: Chain-of-Thought (CoT)
# **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‚≠ê‚≠ê (‡∏Å‡∏•‡∏≤‡∏á)**
# 
# ---
# ## üìñ ‡∏ó‡∏§‡∏©‡∏é‡∏µ
# **Chain-of-Thought (CoT)** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ LLM ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î
# ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
# 
# ### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
# - ‡πÉ‡∏ä‡πâ trigger phrases: "Let's think step by step", "‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô"
# - ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
# - ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡πÅ‡∏•‡∏∞ logic

#%%
# === Lab 2.1: Basic Chain-of-Thought ===
# Task: ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå

# ‚ùå Without CoT
no_cot_prompt = """
‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÄ‡∏™‡∏∑‡πâ‡∏≠ 3 ‡∏ï‡∏±‡∏ß ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞ 250 ‡∏ö‡∏≤‡∏ó ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á 2 ‡∏ï‡∏±‡∏ß ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞ 350 ‡∏ö‡∏≤‡∏ó
‡∏ñ‡πâ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?
"""

response_no_cot = client.models.generate_content(
    model=MODEL_NAME,
    contents=no_cot_prompt
)
print("üîπ Without CoT:")
print(response_no_cot.text)

#%%
# ‚úÖ With CoT
cot_prompt = """
‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÄ‡∏™‡∏∑‡πâ‡∏≠ 3 ‡∏ï‡∏±‡∏ß ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞ 250 ‡∏ö‡∏≤‡∏ó ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á 2 ‡∏ï‡∏±‡∏ß ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞ 350 ‡∏ö‡∏≤‡∏ó
‡∏ñ‡πâ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
"""

response_cot = client.models.generate_content(
    model=MODEL_NAME,
    contents=cot_prompt
)
print("üîπ With CoT:")
print(response_cot.text)

#%%
# === Lab 2.2: CoT ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Logical Reasoning ===
# Task: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à

cot_business_prompt = """
‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
- ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß: 1,000,000 ‡∏ö‡∏≤‡∏ó
- ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: 60% ‡∏Ç‡∏≠‡∏á‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
- ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà: 250,000 ‡∏ö‡∏≤‡∏ó
- ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô 20%

‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°)?

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:
1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≥‡πÑ‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡πÑ‡∏£‡πÉ‡∏´‡∏°‡πà
3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
4. ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
"""

response = client.models.generate_content(
    model=MODEL_NAME,
    contents=cot_business_prompt
)
print("üîπ Business Analysis with CoT:")
print(response.text)

#%%
# === Lab 2.3: Few-shot CoT ===
# ‡∏£‡∏ß‡∏° Few-shot ‡∏Å‡∏±‡∏ö CoT ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô

few_shot_cot_prompt = """
‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏î‡∏¢‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 1:
‡πÇ‡∏à‡∏ó‡∏¢‡πå: ‡∏°‡∏µ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏• 5 ‡∏•‡∏π‡∏Å ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤ 3 ‡∏•‡∏π‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ö‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ 2 ‡∏•‡∏π‡∏Å ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Å‡∏µ‡πà‡∏•‡∏π‡∏Å?
‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î:
- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 1: ‡∏°‡∏µ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô = 5 ‡∏•‡∏π‡∏Å
- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2: ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° = 5 + 3 = 8 ‡∏•‡∏π‡∏Å
- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 3: ‡πÅ‡∏ö‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô = 8 - 2 = 6 ‡∏•‡∏π‡∏Å
‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: 6 ‡∏•‡∏π‡∏Å

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 2:
‡πÇ‡∏à‡∏ó‡∏¢‡πå: ‡∏£‡∏ñ‡∏ß‡∏¥‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß 60 ‡∏Å‡∏°./‡∏ä‡∏°. ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 2.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?
‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î:
- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 1: ‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£ ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á = ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß √ó ‡πÄ‡∏ß‡∏•‡∏≤
- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2: ‡πÅ‡∏ó‡∏ô‡∏Ñ‡πà‡∏≤ = 60 √ó 2.5
- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 3: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì = 150 ‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£
‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: 150 ‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏Å‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ô‡∏µ‡πâ:
‡πÇ‡∏à‡∏ó‡∏¢‡πå: ‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü‡∏Ç‡∏≤‡∏¢‡∏Å‡∏≤‡πÅ‡∏ü‡πÅ‡∏Å‡πâ‡∏ß‡∏•‡∏∞ 50 ‡∏ö‡∏≤‡∏ó ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô 20 ‡∏ö‡∏≤‡∏ó ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ 45 ‡πÅ‡∏Å‡πâ‡∏ß 
       ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 500 ‡∏ö‡∏≤‡∏ó ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?
‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î:
"""

response = client.models.generate_content(
    model=MODEL_NAME,
    contents=few_shot_cot_prompt
)
print("üîπ Few-shot CoT Result:")
print(response.text)

#%% [markdown]
# ### üìù ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î 2: Chain-of-Thought
# 
# **‡πÇ‡∏à‡∏ó‡∏¢‡πå**: ‡πÉ‡∏ä‡πâ CoT ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ:
# "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏°‡∏µ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 50 ‡∏Ñ‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 75 ‡∏Ñ‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 
# ‡∏ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å 2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÜ ‡∏Å‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≠‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏µ‡πà‡∏Ñ‡∏ô?
# ‡πÅ‡∏•‡∏∞‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 1 ‡∏Ñ‡∏ô = 15,000 ‡∏ö‡∏≤‡∏ó ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?"

#%%
# === ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î 2: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Code ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ===

# TODO: ‡∏™‡∏£‡πâ‡∏≤‡∏á CoT prompt
cot_exercise_prompt = """
# ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô prompt ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà


"""

# response = client.models.generate_content(
#     model=MODEL_NAME,
#     contents=cot_exercise_prompt
# )
# print(response.text)

#%% [markdown]
# ---
# # üìò Part 3: Self-Consistency Chain-of-Thought
# **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‚≠ê‚≠ê‚≠ê (‡∏Å‡∏•‡∏≤‡∏á-‡∏™‡∏π‡∏á)**
# 
# ---
# ## üìñ ‡∏ó‡∏§‡∏©‡∏é‡∏µ
# **Self-Consistency CoT** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á 
# ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà consistent (‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô) ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
# 
# ### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
# - ‡∏™‡∏£‡πâ‡∏≤‡∏á reasoning paths ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
# - ‡πÉ‡∏ä‡πâ majority voting ‡∏´‡∏£‡∏∑‡∏≠ weighted voting
# - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
# 
# ### ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ:
# - ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
# - ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
# - ‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

#%%
# === Lab 3.1: Self-Consistency Implementation ===

def self_consistency_cot(prompt: str, num_samples: int = 5, temperature: float = 0.7) -> Dict:
    """
    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà consistent ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
    """
    responses = []
    final_answers = []
    
    for i in range(num_samples):
        response = client.models.generate_content(
            model=MODEL_NAME,
            contents=prompt,
            config=types.GenerateContentConfig(
                temperature=temperature,  # ‡πÄ‡∏û‡∏¥‡πà‡∏° temperature ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢
            )
        )
        responses.append(response.text)
        
        # ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏∂‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:" ‡∏´‡∏£‡∏∑‡∏≠ "Answer:")
        text = response.text.lower()
        # ‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
        numbers = re.findall(r'\b\d+(?:,\d{3})*(?:\.\d+)?\b', response.text)
        if numbers:
            final_answers.append(numbers[-1].replace(',', ''))
        
        print(f"üìù Sample {i+1}: {response.text[:200]}...")
        print("-" * 50)
        time.sleep(1)  # Rate limiting
    
    # ‡∏ô‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
    from collections import Counter
    answer_counts = Counter(final_answers)
    
    return {
        "all_responses": responses,
        "extracted_answers": final_answers,
        "answer_distribution": dict(answer_counts),
        "most_common": answer_counts.most_common(1)[0] if answer_counts else None
    }

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Self-Consistency CoT
problem_prompt = """
‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏°‡∏µ‡πÇ‡∏ï‡πä‡∏∞ 12 ‡πÇ‡∏ï‡πä‡∏∞ ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ 4 ‡∏Ñ‡∏ô
‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤ 35 ‡∏Ñ‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å 2 ‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡∏∞ 6 ‡∏Ñ‡∏ô ‡∏à‡∏∞‡∏°‡∏≤‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á
‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤: ‡∏£‡πâ‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? 
‡πÅ‡∏•‡∏∞‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ ‡∏à‡∏∞‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏µ‡πà‡∏ó‡∏µ‡πà?

‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏¥‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
"""

print("üîÑ Running Self-Consistency CoT (3 samples)...")
result = self_consistency_cot(problem_prompt, num_samples=3)

print("\n" + "="*50)
print("üìä Results Summary:")
print(f"Answer Distribution: {result['answer_distribution']}")
print(f"Most Common Answer: {result['most_common']}")

#%%
# === Lab 3.2: Advanced Self-Consistency with Weighted Voting ===

def advanced_self_consistency(prompt: str, num_samples: int = 5) -> Dict:
    """
    Self-Consistency ‡∏û‡∏£‡πâ‡∏≠‡∏° confidence scoring
    """
    results = []
    
    enhanced_prompt = f"""
{prompt}

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏¥‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ:
1. ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏£‡∏∑‡∏≠ Yes/No)
2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (1-10)

Format:
‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: [your answer]
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: [1-10]
"""
    
    for i in range(num_samples):
        response = client.models.generate_content(
            model=MODEL_NAME,
            contents=enhanced_prompt,
            config=types.GenerateContentConfig(temperature=0.8)
        )
        
        text = response.text
        
        # Extract answer and confidence
        answer_match = re.search(r'‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö[:\s]*([^\n]+)', text)
        confidence_match = re.search(r'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à[:\s]*(\d+)', text)
        
        answer = answer_match.group(1).strip() if answer_match else "N/A"
        confidence = int(confidence_match.group(1)) if confidence_match else 5
        
        results.append({
            "full_response": text,
            "answer": answer,
            "confidence": confidence
        })
        
        print(f"Sample {i+1}: Answer={answer}, Confidence={confidence}/10")
        time.sleep(1)
    
    # Weighted voting
    weighted_answers = {}
    for r in results:
        ans = r["answer"]
        conf = r["confidence"]
        weighted_answers[ans] = weighted_answers.get(ans, 0) + conf
    
    best_answer = max(weighted_answers, key=weighted_answers.get)
    
    return {
        "results": results,
        "weighted_scores": weighted_answers,
        "best_answer": best_answer,
        "total_confidence": weighted_answers[best_answer]
    }

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Advanced Self-Consistency
test_prompt = """
‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏¢‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
- ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏≤‡∏Ç‡∏≤: 2,000,000 ‡∏ö‡∏≤‡∏ó
- ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: 350,000 ‡∏ö‡∏≤‡∏ó
- ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: 280,000 ‡∏ö‡∏≤‡∏ó

‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ‡∏Å‡∏µ‡πà‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏∏‡∏ô? (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°)
"""

print("üîÑ Running Advanced Self-Consistency...")
advanced_result = advanced_self_consistency(test_prompt, num_samples=3)

print("\nüìä Weighted Voting Results:")
print(f"Weighted Scores: {advanced_result['weighted_scores']}")
print(f"Best Answer: {advanced_result['best_answer']}")

#%% [markdown]
# ---
# # üìò Part 4: Prompt Chaining
# **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‚≠ê‚≠ê‚≠ê (‡∏Å‡∏•‡∏≤‡∏á-‡∏™‡∏π‡∏á)**
# 
# ---
# ## üìñ ‡∏ó‡∏§‡∏©‡∏é‡∏µ
# **Prompt Chaining** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏¢‡πà‡∏≠‡∏¢‡πÜ 
# ‡πÇ‡∏î‡∏¢ output ‡∏Ç‡∏≠‡∏á prompt ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô input ‡∏Ç‡∏≠‡∏á prompt ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
# 
# ### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
# - ‡πÅ‡∏ö‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏á‡∏≤‡∏ô‡∏¢‡πà‡∏≠‡∏¢ (Decomposition)
# - ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠ context ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á prompts
# - ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÑ‡∏î‡πâ

#%%
# === Lab 4.1: Basic Prompt Chaining ===
# Task: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°

def prompt_chain_article_analysis(article: str) -> Dict:
    """
    Chain ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
    """
    results = {}
    
    # Step 1: ‡∏™‡∏Å‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
    step1_prompt = f"""
‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏™‡∏Å‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:

‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°:
{article}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏:
1. ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å (Main Topic)
2. ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Key Points) - ‡∏£‡∏∞‡∏ö‡∏∏ 3-5 ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô
3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç/‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
4. ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•/‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

‡∏ï‡∏≠‡∏ö‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö structured format
"""
    
    response1 = client.models.generate_content(model=MODEL_NAME, contents=step1_prompt)
    results["step1_extraction"] = response1.text
    print("‚úÖ Step 1: Information Extraction Complete")
    print(response1.text)
    print("-" * 50)
    
    # Step 2: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå sentiment ‡πÅ‡∏•‡∏∞ tone
    step2_prompt = f"""
‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏Å‡∏±‡∏î‡πÑ‡∏î‡πâ:
{results['step1_extraction']}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:
1. Sentiment ‡∏Ç‡∏≠‡∏á‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏ö‡∏ß‡∏Å/‡∏•‡∏ö/‡∏Å‡∏•‡∏≤‡∏á)
2. Tone ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô (‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£/‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£/‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£)
3. ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°
4. ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô
"""
    
    response2 = client.models.generate_content(model=MODEL_NAME, contents=step2_prompt)
    results["step2_analysis"] = response2.text
    print("‚úÖ Step 2: Sentiment & Tone Analysis Complete")
    print(response2.text)
    print("-" * 50)
    
    # Step 3: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
    step3_prompt = f"""
‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
{results['step1_extraction']}

‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:
{results['step2_analysis']}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á:
1. ‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏° (3-5 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ)
2. ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏≠‡πà‡∏≤‡∏ô
3. ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ï‡πà‡∏≠
4. ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
"""
    
    response3 = client.models.generate_content(model=MODEL_NAME, contents=step3_prompt)
    results["step3_summary"] = response3.text
    print("‚úÖ Step 3: Summary & Recommendations Complete")
    print(response3.text)
    
    return results

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Prompt Chaining
sample_article = """
‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø - ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ñ‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà 2.50% 
‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡∏Å‡∏ô‡∏á.) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‡∏ô‡∏µ‡πâ ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏°‡∏ï‡∏¥‡πÄ‡∏≠‡∏Å‡∏â‡∏±‡∏ô‡∏ó‡πå 7-0 ‡πÄ‡∏™‡∏µ‡∏¢‡∏á

‡∏ô‡∏≤‡∏¢‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏û‡∏∏‡∏í‡∏¥ ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ß‡∏≤‡∏ó‡∏ô‡∏§‡∏û‡∏∏‡∏í‡∏¥ ‡∏ú‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ ‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ß‡πà‡∏≤ 
‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤ 
‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡πÇ‡∏•‡∏Å‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô

‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ GDP ‡πÑ‡∏ó‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏±‡∏ß 2.8% ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà 2.5% 
‡∏Ç‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà 0.8% ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 1-3%

‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤ ‡∏Å‡∏ô‡∏á. ‡∏à‡∏∞‡∏Ñ‡∏á‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏õ‡∏µ‡∏´‡∏ô‡πâ‡∏≤ 
‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î‡∏´‡∏≤‡∏Å‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡∏ä‡∏∞‡∏•‡∏≠‡∏ï‡∏±‡∏ß
"""

print("üîó Starting Prompt Chain Analysis...")
chain_results = prompt_chain_article_analysis(sample_article)

#%%
# === Lab 4.2: Complex Prompt Chaining - Business Analysis ===

def business_analysis_chain(company_data: str) -> Dict:
    """
    Chain ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£
    """
    results = {}
    
    # Chain 1: SWOT Analysis
    chain1 = f"""
‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå SWOT ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:
{company_data}

‡∏£‡∏∞‡∏ö‡∏∏:
- Strengths (‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á): 3-4 ‡∏Ç‡πâ‡∏≠
- Weaknesses (‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô): 3-4 ‡∏Ç‡πâ‡∏≠
- Opportunities (‡πÇ‡∏≠‡∏Å‡∏≤‡∏™): 3-4 ‡∏Ç‡πâ‡∏≠
- Threats (‡∏†‡∏±‡∏¢‡∏Ñ‡∏∏‡∏Å‡∏Ñ‡∏≤‡∏°): 3-4 ‡∏Ç‡πâ‡∏≠
"""
    
    response1 = client.models.generate_content(model=MODEL_NAME, contents=chain1)
    results["swot"] = response1.text
    print("‚úÖ Chain 1: SWOT Analysis Done")
    
    # Chain 2: Strategic Recommendations based on SWOT
    chain2 = f"""
‡∏à‡∏≤‡∏Å SWOT Analysis:
{results['swot']}

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå:
1. SO Strategy (‡πÉ‡∏ä‡πâ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏Ñ‡∏ß‡πâ‡∏≤‡πÇ‡∏≠‡∏Å‡∏≤‡∏™)
2. WO Strategy (‡πÅ‡∏Å‡πâ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏≠‡∏Å‡∏≤‡∏™)
3. ST Strategy (‡πÉ‡∏ä‡πâ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏∏‡∏Å‡∏Ñ‡∏≤‡∏°)
4. WT Strategy (‡∏•‡∏î‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏†‡∏±‡∏¢‡∏Ñ‡∏∏‡∏Å‡∏Ñ‡∏≤‡∏°)

‡∏£‡∏∞‡∏ö‡∏∏ action items ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå
"""
    
    response2 = client.models.generate_content(model=MODEL_NAME, contents=chain2)
    results["strategies"] = response2.text
    print("‚úÖ Chain 2: Strategic Recommendations Done")
    
    # Chain 3: Implementation Roadmap
    chain3 = f"""
‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ:
{results['strategies']}

‡∏™‡∏£‡πâ‡∏≤‡∏á Implementation Roadmap:
1. Quick Wins (0-3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô): ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
2. Short-term (3-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô): ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô
3. Medium-term (6-12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô): ‡πÅ‡∏ú‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏•‡∏≤‡∏á
4. Long-term (1-2 ‡∏õ‡∏µ): ‡∏ß‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏±‡∏®‡∏ô‡πå‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß

‡∏£‡∏∞‡∏ö‡∏∏ KPIs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á
"""
    
    response3 = client.models.generate_content(model=MODEL_NAME, contents=chain3)
    results["roadmap"] = response3.text
    print("‚úÖ Chain 3: Implementation Roadmap Done")
    
    return results

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Business Analysis Chain
company_info = """
‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó TechStart Co., Ltd.
- ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à: ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
- ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: 25 ‡∏Ñ‡∏ô
- ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß: 15 ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó
- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å: SMEs ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢
- ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô: ‡∏ó‡∏µ‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ù‡∏µ‡∏°‡∏∑‡∏≠‡∏î‡∏µ, ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÑ‡∏î‡πâ
- ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á, ‡∏Ç‡∏≤‡∏î Product Manager
- ‡∏ï‡∏•‡∏≤‡∏î: ‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô, ‡∏°‡∏µ Freelancer ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô
- ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™: Digital Transformation ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏ï, ‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏° Tech Startup
"""

print("üè¢ Starting Business Analysis Chain...")
business_results = business_analysis_chain(company_info)

#%% [markdown]
# ---
# # üìò Part 5: Reflection
# **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‚≠ê‚≠ê‚≠ê‚≠ê (‡∏™‡∏π‡∏á)**
# 
# ---
# ## üìñ ‡∏ó‡∏§‡∏©‡∏é‡∏µ
# **Reflection** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ LLM ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
# ‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
# 
# ### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
# - ‡∏™‡∏£‡πâ‡∏≤‡∏á Initial Response
# - ‡πÉ‡∏´‡πâ LLM ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
# - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå

#%%
# === Lab 5.1: Basic Reflection Pattern ===

def reflection_prompt(task: str) -> Dict:
    """
    Reflection pattern: Generate -> Reflect -> Improve
    """
    results = {}
    
    # Step 1: Initial Response
    initial_prompt = f"""
{task}

‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
"""
    
    response1 = client.models.generate_content(model=MODEL_NAME, contents=initial_prompt)
    results["initial_response"] = response1.text
    print("üìù Initial Response:")
    print(response1.text)
    print("=" * 50)
    
    # Step 2: Reflection
    reflection_prompt = f"""
‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:

‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°/‡∏á‡∏≤‡∏ô:
{task}

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏õ:
{results['initial_response']}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:
1. ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (2-3 ‡∏Ç‡πâ‡∏≠)
2. ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢ (2-3 ‡∏Ç‡πâ‡∏≠)
3. ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ
4. ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
"""
    
    response2 = client.models.generate_content(model=MODEL_NAME, contents=reflection_prompt)
    results["reflection"] = response2.text
    print("üîç Reflection:")
    print(response2.text)
    print("=" * 50)
    
    # Step 3: Improved Response
    improvement_prompt = f"""
‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô:

‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°/‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°:
{task}

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏î‡∏¥‡∏°:
{results['initial_response']}

‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:
{results['reflection']}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏î‡∏¢‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢
"""
    
    response3 = client.models.generate_content(model=MODEL_NAME, contents=improvement_prompt)
    results["improved_response"] = response3.text
    print("‚ú® Improved Response:")
    print(response3.text)
    
    return results

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Reflection
task = """
‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤ 3 ‡∏ß‡∏±‡∏ô 
‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏ô‡∏≠‡∏ä‡∏î‡πÄ‡∏ä‡∏¢
"""

print("üîÑ Starting Reflection Process...")
reflection_results = reflection_prompt(task)

#%%
# === Lab 5.2: Multi-round Reflection ===

def iterative_reflection(task: str, max_iterations: int = 3) -> Dict:
    """
    Reflection ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≠‡∏ö‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏û‡∏≠‡πÉ‡∏à
    """
    results = {"iterations": []}
    
    current_response = None
    
    for i in range(max_iterations):
        print(f"\nüîÑ Iteration {i + 1}")
        print("=" * 50)
        
        if current_response is None:
            # First iteration: Generate initial response
            prompt = f"{task}\n\n‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
        else:
            # Subsequent iterations: Reflect and improve
            prompt = f"""
‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°/‡∏á‡∏≤‡∏ô:
{task}

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:
{current_response}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤:
1. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏î‡∏µ‡∏û‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á (‡∏ï‡∏≠‡∏ö YES ‡∏´‡∏£‡∏∑‡∏≠ NO)
2. ‡∏ñ‡πâ‡∏≤ NO: ‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
3. ‡∏ñ‡πâ‡∏≤ YES: ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß

Format:
STATUS: [YES/NO]
ANALYSIS: [‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå]
RESPONSE: [‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö - ‡∏ñ‡πâ‡∏≤ NO ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà, ‡∏ñ‡πâ‡∏≤ YES ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏î‡∏¥‡∏°]
"""
        
        response = client.models.generate_content(model=MODEL_NAME, contents=prompt)
        response_text = response.text
        
        results["iterations"].append({
            "iteration": i + 1,
            "response": response_text
        })
        
        print(response_text)
        
        # Check if satisfied
        if "STATUS: YES" in response_text.upper() or "STATUS:YES" in response_text.upper():
            print("\n‚úÖ Reflection Complete - Satisfied with response")
            break
        
        current_response = response_text
        time.sleep(1)
    
    results["final_response"] = results["iterations"][-1]["response"]
    return results

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Iterative Reflection
complex_task = """
‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Loyalty Program ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü‡∏ó‡∏µ‡πà‡∏°‡∏µ 3 ‡∏™‡∏≤‡∏Ç‡∏≤
‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏∂‡∏á‡∏ñ‡∏∂‡∏á:
- ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡∏≥‡∏Å‡∏±‡∏î
- ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° repeat customers 30%
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢
"""

print("üîÑ Starting Iterative Reflection...")
iter_results = iterative_reflection(complex_task, max_iterations=3)

#%% [markdown]
# ---
# # üìò Part 6: Tree-of-Thought (ToT)
# **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å)**
# 
# ---
# ## üìñ ‡∏ó‡∏§‡∏©‡∏é‡∏µ
# **Tree-of-Thought (ToT)** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
# ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏°‡∏≤‡∏Å‡∏£‡∏∏‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏ï‡∏≤‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
# 
# ### ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
# - Generate: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
# - Evaluate: ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
# - Expand: ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏î‡∏µ
# - Select: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

#%%
# === Lab 6.1: Tree-of-Thought Implementation ===

def tree_of_thought(problem: str, num_branches: int = 3, depth: int = 2) -> Dict:
    """
    Tree-of-Thought: ‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
    """
    results = {
        "problem": problem,
        "tree": {}
    }
    
    # Step 1: Generate initial branches (approaches)
    generate_prompt = f"""
‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
{problem}

‡∏™‡∏£‡πâ‡∏≤‡∏á {num_branches} ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á ‡πÉ‡∏´‡πâ:
1. ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á
2. ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏´‡∏•‡∏±‡∏Å
3. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥

Format:
APPROACH 1:
Name: [‡∏ä‡∏∑‡πà‡∏≠]
Concept: [‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î]
First Step: [‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å]

APPROACH 2:
...
"""
    
    response1 = client.models.generate_content(model=MODEL_NAME, contents=generate_prompt)
    results["tree"]["initial_branches"] = response1.text
    print("üå≥ Initial Branches Generated:")
    print(response1.text)
    print("=" * 50)
    
    # Step 2: Evaluate each branch
    evaluate_prompt = f"""
‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ:

‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
{problem}

‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠:
{results['tree']['initial_branches']}

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 1-10 ‡πÉ‡∏ô‡∏î‡πâ‡∏≤‡∏ô:
1. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ (Feasibility)
2. ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û (Effectiveness)
3. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (Risk - ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á = ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥)
4. ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ (Resources - ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á = ‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≠‡∏¢)

‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
"""
    
    response2 = client.models.generate_content(model=MODEL_NAME, contents=evaluate_prompt)
    results["tree"]["evaluation"] = response2.text
    print("üìä Branch Evaluation:")
    print(response2.text)
    print("=" * 50)
    
    # Step 3: Expand best branch
    expand_prompt = f"""
‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:
{results['tree']['evaluation']}

‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:

1. ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
2. ‡∏£‡∏∞‡∏ö‡∏∏ milestones ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
3. ‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠
4. ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°
5. Timeline ‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ
"""
    
    response3 = client.models.generate_content(model=MODEL_NAME, contents=expand_prompt)
    results["tree"]["expanded_solution"] = response3.text
    print("üéØ Expanded Best Solution:")
    print(response3.text)
    
    return results

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Tree-of-Thought
business_problem = """
‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏•‡∏î‡∏•‡∏á 40% 
‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏à‡∏≤‡∏Å e-commerce ‡πÅ‡∏•‡∏∞ e-book
‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á 500,000 ‡∏ö‡∏≤‡∏ó
‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡∏£‡∏≠‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏õ‡∏µ
"""

print("üå≥ Starting Tree-of-Thought Analysis...")
tot_results = tree_of_thought(business_problem)

#%% [markdown]
# ---
# # üìò Part 7: Self-Feedback
# **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‚≠ê‚≠ê‚≠ê‚≠ê (‡∏™‡∏π‡∏á)**
# 
# ---
# ## üìñ ‡∏ó‡∏§‡∏©‡∏é‡∏µ
# **Self-Feedback** ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ LLM ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
# ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ feedback ‡∏ô‡∏±‡πâ‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
# 
# ### ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å Reflection:
# - Reflection: ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
# - Self-Feedback: ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô

#%%
# === Lab 7.1: Self-Feedback with Criteria ===

def self_feedback_with_criteria(task: str, criteria: List[str]) -> Dict:
    """
    Self-Feedback ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    """
    results = {}
    
    # Step 1: Generate initial response
    initial_prompt = f"{task}"
    
    response1 = client.models.generate_content(model=MODEL_NAME, contents=initial_prompt)
    results["initial_response"] = response1.text
    print("üìù Initial Response:")
    print(response1.text)
    print("=" * 50)
    
    # Step 2: Self-Feedback based on criteria
    criteria_text = "\n".join([f"- {c}" for c in criteria])
    feedback_prompt = f"""
‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î:

‡∏á‡∏≤‡∏ô:
{task}

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:
{results['initial_response']}

‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:
{criteria_text}

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Å‡∏ì‡∏ë‡πå:
1. ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 1-10
2. ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
3. ‡πÄ‡∏™‡∏ô‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á

Format:
[‡πÄ‡∏Å‡∏ì‡∏ë‡πå 1]: [‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô]/10
- ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ...
- ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á: ...
"""
    
    response2 = client.models.generate_content(model=MODEL_NAME, contents=feedback_prompt)
    results["self_feedback"] = response2.text
    print("üîç Self-Feedback:")
    print(response2.text)
    print("=" * 50)
    
    # Step 3: Improve based on feedback
    improve_prompt = f"""
‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡∏≤‡∏° feedback:

‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°:
{task}

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏î‡∏¥‡∏°:
{results['initial_response']}

Feedback:
{results['self_feedback']}

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ï‡∏≤‡∏° feedback ‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠
"""
    
    response3 = client.models.generate_content(model=MODEL_NAME, contents=improve_prompt)
    results["improved_response"] = response3.text
    print("‚ú® Improved Response:")
    print(response3.text)
    
    return results

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Self-Feedback
writing_task = """
‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô (200-300 ‡∏Ñ‡∏≥) ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö "‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡∏≠‡∏á AI ‡∏ï‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢"
"""

criteria = [
    "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Accuracy)",
    "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (Completeness)",
    "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ (Clarity)",
    "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à (Engagement)",
    "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Objectivity)"
]

print("üîÑ Starting Self-Feedback Process...")
sf_results = self_feedback_with_criteria(writing_task, criteria)

#%% [markdown]
# ---
# # üìò Part 8: Self-Critique
# **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å)**
# 
# ---
# ## üìñ ‡∏ó‡∏§‡∏©‡∏é‡∏µ
# **Self-Critique** ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà LLM ‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î
# ‡πÇ‡∏î‡∏¢‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
# 
# ### ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å Self-Feedback:
# - Self-Feedback: ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
# - Self-Critique: ‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏≤ "‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î"

#%%
# === Lab 8.1: Adversarial Self-Critique ===

def adversarial_self_critique(task: str, num_rounds: int = 2) -> Dict:
    """
    Self-Critique ‡πÅ‡∏ö‡∏ö Adversarial: ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏±‡∏Å‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
    """
    results = {"rounds": []}
    current_response = None
    
    for round_num in range(num_rounds):
        print(f"\nüîÑ Round {round_num + 1}")
        print("=" * 50)
        
        # Generate/Improve response
        if current_response is None:
            gen_prompt = f"{task}\n\n‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
        else:
            gen_prompt = f"""
‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå:
{current_critique}

‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°:
{task}

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤:
{current_response}

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå‡πÑ‡∏ß‡πâ
"""
        
        response = client.models.generate_content(model=MODEL_NAME, contents=gen_prompt)
        current_response = response.text
        print("üìù Response:")
        print(current_response)
        
        # Adversarial Critique
        critique_prompt = f"""
‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î (Harsh Critic) ‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏µ‡πâ:

‡∏á‡∏≤‡∏ô:
{task}

‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:
{current_response}

‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏≤:
1. ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏≤‡∏á‡∏ï‡∏£‡∏£‡∏Å‡∏∞ (Logical Fallacies)
2. ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (Unsupported Assumptions)
3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Potentially Incorrect Information)
4. ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á (Weak Arguments)
5. ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ (Missing Elements)
6. Bias ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ (Potential Biases)

‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î - ‡∏≠‡∏¢‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏ô‡∏µ‡∏õ‡∏£‡∏∞‡∏ô‡∏≠‡∏°!
"""
        
        critique_response = client.models.generate_content(model=MODEL_NAME, contents=critique_prompt)
        current_critique = critique_response.text
        print("\n‚öîÔ∏è Critique:")
        print(current_critique)
        
        results["rounds"].append({
            "round": round_num + 1,
            "response": current_response,
            "critique": current_critique
        })
        
        time.sleep(1)
    
    # Final synthesis
    synthesis_prompt = f"""
‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ú‡πà‡∏≤‡∏ô {num_rounds} ‡∏£‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á

‡∏á‡∏≤‡∏ô:
{task}

‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:
{json.dumps(results['rounds'], ensure_ascii=False, indent=2)}

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà:
1. ‡∏£‡∏ß‡∏°‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏£‡∏≠‡∏ö
2. ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå
3. ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏ö
"""
    
    final_response = client.models.generate_content(model=MODEL_NAME, contents=synthesis_prompt)
    results["final_response"] = final_response.text
    print("\nüèÜ Final Response:")
    print(final_response.text)
    
    return results

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Self-Critique
controversial_task = """
‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ñ‡∏ß‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏® 100% ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"
‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏¢‡∏à‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏à‡πâ‡∏≤‡∏á
"""

print("‚öîÔ∏è Starting Adversarial Self-Critique...")
critique_results = adversarial_self_critique(controversial_task, num_rounds=2)

#%% [markdown]
# ---
# # üìä Part 9: Evaluation Methods
# **LLM-as-a-Judge & Reference-free Evaluation**
# 
# ---
# ## üìñ ‡∏ó‡∏§‡∏©‡∏é‡∏µ
# ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û output ‡∏Ç‡∏≠‡∏á LLM ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÇ‡∏î‡∏¢‡∏°‡∏µ 2 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏•‡∏±‡∏Å:
# 
# ### 1. LLM-as-a-Judge
# ‡πÉ‡∏ä‡πâ LLM ‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô (‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô) ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô
# 
# ### 2. Reference-free Evaluation
# ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á

#%%
# === Lab 9.1: LLM-as-a-Judge ===

def llm_as_judge(task: str, response: str, rubric: Dict[str, str] = None) -> Dict:
    """
    ‡πÉ‡∏ä‡πâ LLM ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á response
    """
    
    if rubric is None:
        rubric = {
            "relevance": "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡∏£‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏°‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÉ‡∏î",
            "accuracy": "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÉ‡∏î",
            "completeness": "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏°‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÉ‡∏î",
            "clarity": "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÉ‡∏î",
            "helpfulness": "‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ñ‡∏≤‡∏°‡∏°‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÉ‡∏î"
        }
    
    rubric_text = "\n".join([f"- {k}: {v}" for k, v in rubric.items()])
    
    judge_prompt = f"""
‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:

=== ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°/‡∏á‡∏≤‡∏ô ===
{task}

=== ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ===
{response}

=== ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ===
{rubric_text}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏î‡∏¢:
1. ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Å‡∏ì‡∏ë‡πå (1-10)
2. ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
3. ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° (1-10)
4. ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô
5. ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á

Format:
SCORES:
- relevance: [score]/10 - [reason]
- accuracy: [score]/10 - [reason]
- completeness: [score]/10 - [reason]
- clarity: [score]/10 - [reason]
- helpfulness: [score]/10 - [reason]

OVERALL: [score]/10

STRENGTHS:
- ...

WEAKNESSES:
- ...

SUGGESTIONS:
- ...
"""
    
    judge_response = client.models.generate_content(model=MODEL_NAME, contents=judge_prompt)
    
    # Parse scores (simplified)
    result = {
        "task": task,
        "response": response,
        "evaluation": judge_response.text
    }
    
    # Extract overall score
    import re
    overall_match = re.search(r'OVERALL:\s*(\d+(?:\.\d+)?)/10', judge_response.text)
    if overall_match:
        result["overall_score"] = float(overall_match.group(1))
    
    return result

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö LLM-as-a-Judge

# ‡∏™‡∏£‡πâ‡∏≤‡∏á response ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
test_task = "‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Blockchain ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢"

test_response = """
Blockchain ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏®‡∏π‡∏ô‡∏¢‡πå ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏™‡∏°‡∏∏‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ñ‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô

‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
1. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ transaction ‡πÉ‡∏´‡∏°‡πà ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô "block"
2. Block ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô block ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö block ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
4. ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏ó‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ó‡∏∏‡∏Å block ‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏°‡∏≤

‡∏Ç‡πâ‡∏≠‡∏î‡∏µ: ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á
‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢: ‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡∏Å ‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
"""

print("‚öñÔ∏è LLM-as-a-Judge Evaluation:")
judge_result = llm_as_judge(test_task, test_response)
print(judge_result["evaluation"])
if "overall_score" in judge_result:
    print(f"\nüìä Overall Score: {judge_result['overall_score']}/10")

#%%
# === Lab 9.2: Pairwise Comparison (LLM-as-a-Judge variant) ===

def pairwise_comparison(task: str, response_a: str, response_b: str) -> Dict:
    """
    ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö 2 ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
    """
    
    compare_prompt = f"""
‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö 2 ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:

=== ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°/‡∏á‡∏≤‡∏ô ===
{task}

=== ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö A ===
{response_a}

=== ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö B ===
{response_b}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤:
1. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
2. ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô‡∏î‡πâ‡∏≤‡∏ô:
   - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
   - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
   - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
   - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå
3. ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏´‡∏ô‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤

Format:
ANALYSIS A:
- Strengths: ...
- Weaknesses: ...

ANALYSIS B:
- Strengths: ...
- Weaknesses: ...

COMPARISON:
- Accuracy: A/B/Tie - [reason]
- Completeness: A/B/Tie - [reason]
- Clarity: A/B/Tie - [reason]
- Helpfulness: A/B/Tie - [reason]

WINNER: [A/B/Tie]
REASON: [explanation]
"""
    
    response = client.models.generate_content(model=MODEL_NAME, contents=compare_prompt)
    
    return {
        "task": task,
        "response_a": response_a,
        "response_b": response_b,
        "comparison": response.text
    }

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Pairwise Comparison
comparison_task = "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô"

response_a = """
‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÄ‡∏á‡∏¥‡∏ô:
1. ‡∏ó‡∏≥‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
2. ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô 10-20% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ
3. ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
4. ‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏á‡πÅ‡∏ó‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡πâ‡∏≤‡∏ß‡∏ô‡∏≠‡∏Å‡∏ö‡πâ‡∏≤‡∏ô
5. ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞
"""

response_b = """
‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏•‡∏±‡∏Å 50/30/20:
- 50% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô (‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á)
- 30% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö lifestyle (‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß entertainment)
- 20% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡∏°/‡∏•‡∏á‡∏ó‡∏∏‡∏ô

Tips ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:
1. ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å - ‡∏ï‡∏±‡πâ‡∏á auto transfer ‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
2. ‡πÉ‡∏ä‡πâ‡πÅ‡∏≠‡∏õ track ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô Money Lover
3. ‡∏£‡∏≠ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏û‡∏á
4. ‡∏´‡∏≤ side income ‡πÄ‡∏û‡∏¥‡πà‡∏°
5. ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô

‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏°‡∏µ Emergency Fund 3-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏õ‡∏µ
"""

print("üîÑ Pairwise Comparison:")
comparison_result = pairwise_comparison(comparison_task, response_a, response_b)
print(comparison_result["comparison"])

#%%
# === Lab 9.3: Reference-free Evaluation ===

def reference_free_evaluation(task: str, response: str, evaluation_aspects: List[str] = None) -> Dict:
    """
    ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
    """
    
    if evaluation_aspects is None:
        evaluation_aspects = [
            "Fluency (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏©‡∏≤)",
            "Coherence (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤)",
            "Informativeness (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)",
            "Factual Consistency (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á)",
            "No Hallucination (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡πá‡∏à)"
        ]
    
    aspects_text = "\n".join([f"- {a}" for a in evaluation_aspects])
    
    eval_prompt = f"""
‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á text ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á:

=== Task/Context ===
{task}

=== Text to Evaluate ===
{response}

=== Evaluation Aspects ===
{aspects_text}

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ aspect:
1. ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 1-10
2. ‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏à‡∏≤‡∏Å text
3. ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)

‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö potential hallucinations (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏à‡∏£‡∏¥‡∏á)
- ‡∏£‡∏∞‡∏ö‡∏∏ claims ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ verification
- ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô overall quality

Format:
[Aspect 1]: [score]/10
- Evidence: [quote from text]
- Issues: [problems found]

...

POTENTIAL HALLUCINATIONS:
- [list suspicious claims]

CLAIMS NEEDING VERIFICATION:
- [list claims that should be fact-checked]

OVERALL QUALITY: [score]/10
SUMMARY: [brief summary]
"""
    
    response_eval = client.models.generate_content(model=MODEL_NAME, contents=eval_prompt)
    
    return {
        "task": task,
        "response": response,
        "reference_free_evaluation": response_eval.text
    }

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Reference-free Evaluation
test_text_task = "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ç‡∏≠‡∏á Bitcoin"

test_text = """
Bitcoin ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏õ‡∏µ 2009 ‡πÇ‡∏î‡∏¢ Satoshi Nakamoto ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏°‡πÅ‡∏ù‡∏á 
‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏£‡∏π‡πâ‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á

‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
- 2008: ‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà whitepaper
- 2009: ‡∏Ç‡∏∏‡∏î block ‡πÅ‡∏£‡∏Å (Genesis Block) 
- 2010: ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤ 2 ‡∏ñ‡∏≤‡∏î‡∏î‡πâ‡∏ß‡∏¢ 10,000 BTC (‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏û‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏ô)
- 2017: ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏∏‡πà‡∏á‡πÅ‡∏ï‡∏∞ $20,000 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
- 2021: ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏≥ all-time high ‡∏ó‡∏µ‡πà $69,000
- 2024: ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ Bitcoin ETF ‡πÉ‡∏ô‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏Ø

Bitcoin ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ Blockchain ‡πÅ‡∏•‡∏∞‡∏°‡∏µ supply ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà 21 ‡∏•‡πâ‡∏≤‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç
‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏°‡∏≠‡∏á‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "digital gold"
"""

print("üìã Reference-free Evaluation:")
ref_free_result = reference_free_evaluation(test_text_task, test_text)
print(ref_free_result["reference_free_evaluation"])

#%% [markdown]
# ---
# # üìä Part 10: Comprehensive Evaluation Framework
# **‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ Evaluation ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô**
# 
# ---

#%%
# === Lab 10.1: Complete Evaluation Pipeline ===

class ComprehensiveEvaluator:
    """
    Evaluation Framework ‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô
    """
    
    def __init__(self, client, model_name: str):
        self.client = client
        self.model_name = model_name
    
    def evaluate(self, task: str, response: str, include_pairwise: bool = False, 
                 alternative_response: str = None) -> Dict:
        """
        ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£
        """
        results = {
            "task": task,
            "response": response,
            "evaluations": {}
        }
        
        print("üîç Starting Comprehensive Evaluation...")
        print("=" * 50)
        
        # 1. LLM-as-a-Judge (Multi-aspect)
        print("\nüìä 1. LLM-as-a-Judge Evaluation")
        judge_result = self._llm_judge(task, response)
        results["evaluations"]["llm_judge"] = judge_result
        print(f"   Score: {judge_result.get('overall_score', 'N/A')}/10")
        
        # 2. Reference-free Evaluation
        print("\nüìã 2. Reference-free Evaluation")
        ref_free_result = self._reference_free(task, response)
        results["evaluations"]["reference_free"] = ref_free_result
        
        # 3. Hallucination Check
        print("\nüîé 3. Hallucination Detection")
        hallucination_result = self._check_hallucinations(task, response)
        results["evaluations"]["hallucination_check"] = hallucination_result
        
        # 4. Pairwise Comparison (if alternative provided)
        if include_pairwise and alternative_response:
            print("\n‚öñÔ∏è 4. Pairwise Comparison")
            pairwise_result = self._pairwise_compare(task, response, alternative_response)
            results["evaluations"]["pairwise"] = pairwise_result
        
        # 5. Aggregate Score
        results["aggregate_score"] = self._calculate_aggregate(results["evaluations"])
        
        return results
    
    def _llm_judge(self, task: str, response: str) -> Dict:
        """LLM-as-a-Judge evaluation"""
        prompt = f"""
‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:

Task: {task}
Response: {response}

‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 1-10 ‡πÉ‡∏ô‡∏î‡πâ‡∏≤‡∏ô:
1. Relevance (‡∏ï‡∏£‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô)
2. Accuracy (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
3. Completeness (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô)
4. Clarity (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)
5. Helpfulness (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå)

Format:
SCORES:
relevance: [score]
accuracy: [score]
completeness: [score]
clarity: [score]
helpfulness: [score]
OVERALL: [average score]
"""
        result = self.client.models.generate_content(model=self.model_name, contents=prompt)
        
        # Extract overall score
        overall_match = re.search(r'OVERALL:\s*(\d+(?:\.\d+)?)', result.text)
        overall_score = float(overall_match.group(1)) if overall_match else None
        
        return {
            "raw_evaluation": result.text,
            "overall_score": overall_score
        }
    
    def _reference_free(self, task: str, response: str) -> Dict:
        """Reference-free quality assessment"""
        prompt = f"""
‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û text ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ reference:

Task: {task}
Text: {response}

‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:
1. Fluency (1-10)
2. Coherence (1-10)
3. Informativeness (1-10)

Format:
fluency: [score]
coherence: [score]
informativeness: [score]
"""
        result = self.client.models.generate_content(model=self.model_name, contents=prompt)
        return {"evaluation": result.text}
    
    def _check_hallucinations(self, task: str, response: str) -> Dict:
        """Check for potential hallucinations"""
        prompt = f"""
‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö potential hallucinations ‡πÉ‡∏ô text:

Task: {task}
Text: {response}

‡∏£‡∏∞‡∏ö‡∏∏:
1. Claims ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏±‡∏¢
2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£ fact-check
3. Confidence level ‡∏ß‡πà‡∏≤‡∏°‡∏µ hallucination ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (HIGH/MEDIUM/LOW)

Format:
SUSPICIOUS_CLAIMS: [list]
NEEDS_VERIFICATION: [list]
HALLUCINATION_RISK: [HIGH/MEDIUM/LOW]
"""
        result = self.client.models.generate_content(model=self.model_name, contents=prompt)
        return {"hallucination_check": result.text}
    
    def _pairwise_compare(self, task: str, response_a: str, response_b: str) -> Dict:
        """Pairwise comparison"""
        prompt = f"""
‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö 2 ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:

Task: {task}
Response A: {response_a}
Response B: {response_b}

WINNER: [A/B/Tie]
REASON: [explanation]
"""
        result = self.client.models.generate_content(model=self.model_name, contents=prompt)
        return {"comparison": result.text}
    
    def _calculate_aggregate(self, evaluations: Dict) -> Dict:
        """Calculate aggregate score from all evaluations"""
        scores = []
        
        if "llm_judge" in evaluations and evaluations["llm_judge"].get("overall_score"):
            scores.append(evaluations["llm_judge"]["overall_score"])
        
        if scores:
            return {
                "average_score": sum(scores) / len(scores),
                "num_evaluations": len(scores)
            }
        return {"average_score": None, "num_evaluations": 0}

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Comprehensive Evaluator
evaluator = ComprehensiveEvaluator(client, MODEL_NAME)

test_task = "‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Machine Learning ‡∏Å‡∏±‡∏ö Deep Learning"

test_response = """
Machine Learning (ML) ‡πÅ‡∏•‡∏∞ Deep Learning (DL) ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

Machine Learning:
- ‡πÉ‡∏ä‡πâ algorithm ‡πÅ‡∏ö‡∏ö‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏ä‡πà‡∏ô Decision Tree, SVM, Linear Regression
- ‡∏ï‡πâ‡∏≠‡∏á feature engineering ‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠
- ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏°‡∏≤‡∏Å

Deep Learning:
- ‡πÉ‡∏ä‡πâ Neural Networks ‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ features ‡πÄ‡∏≠‡∏á
- ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏Å
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö image, text, speech

DL ‡πÄ‡∏õ‡πá‡∏ô subset ‡∏Ç‡∏≠‡∏á ML ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
"""

evaluation_results = evaluator.evaluate(test_task, test_response)
print("\n" + "=" * 50)
print("üìä Final Aggregate Score:", evaluation_results["aggregate_score"])

#%% [markdown]
# ---
# # üéØ Part 11: Final Challenge - Combined Techniques
# **‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏≤**
# 
# ---

#%%
# === Final Challenge: Build a Complete Analysis System ===

def advanced_analysis_system(problem: str) -> Dict:
    """
    ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ:
    1. Tree-of-Thought ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    2. Self-Consistency ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠
    3. Reflection ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á
    4. Self-Critique ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
    5. LLM-as-a-Judge ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
    """
    
    results = {"stages": {}}
    
    print("üöÄ Starting Advanced Analysis System")
    print("=" * 60)
    
    # Stage 1: Few-shot + CoT for initial analysis
    print("\nüìå Stage 1: Initial Analysis with Few-shot CoT")
    stage1_prompt = f"""
‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á:

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏•‡∏µ‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏•‡∏î‡∏•‡∏á
‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:
- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 1: ‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ ‚Üí ‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏™‡∏π‡∏á, ‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à, ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ
- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2: ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö ‚Üí ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏•‡∏î, ‡∏Å‡∏≥‡πÑ‡∏£‡∏•‡∏î
- ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 3: ‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å ‚Üí ‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå, ‡∏•‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô

‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:
{problem}

‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
"""
    
    response1 = client.models.generate_content(model=MODEL_NAME, contents=stage1_prompt)
    results["stages"]["initial_analysis"] = response1.text
    print(response1.text[:500] + "...")
    
    # Stage 2: Tree-of-Thought for solutions
    print("\nüìå Stage 2: Tree-of-Thought for Solutions")
    stage2_prompt = f"""
‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:
{results['stages']['initial_analysis'][:1000]}

‡∏™‡∏£‡πâ‡∏≤‡∏á 3 ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡πÇ‡∏î‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ:
- ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏´‡∏•‡∏±‡∏Å
- ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ/‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ (1-10)

‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
"""
    
    response2 = client.models.generate_content(model=MODEL_NAME, contents=stage2_prompt)
    results["stages"]["solutions_tree"] = response2.text
    print(response2.text[:500] + "...")
    
    # Stage 3: Reflection and Improvement
    print("\nüìå Stage 3: Reflection & Improvement")
    stage3_prompt = f"""
‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:
{results['stages']['solutions_tree'][:1000]}

1. ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô
2. ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
3. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î
4. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
"""
    
    response3 = client.models.generate_content(model=MODEL_NAME, contents=stage3_prompt)
    results["stages"]["reflection"] = response3.text
    print(response3.text[:500] + "...")
    
    # Stage 4: Self-Critique
    print("\nüìå Stage 4: Self-Critique")
    stage4_prompt = f"""
‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î ‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ:
{results['stages']['reflection'][:1000]}

‡∏´‡∏≤:
1. ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏≤‡∏á‡∏ï‡∏£‡∏£‡∏Å‡∏∞
2. ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ú‡∏¥‡∏î
3. ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢
4. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏°
"""
    
    response4 = client.models.generate_content(model=MODEL_NAME, contents=stage4_prompt)
    results["stages"]["critique"] = response4.text
    print(response4.text[:500] + "...")
    
    # Stage 5: Final Synthesis
    print("\nüìå Stage 5: Final Synthesis")
    stage5_prompt = f"""
‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:

‡∏õ‡∏±‡∏ç‡∏´‡∏≤: {problem}

‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: {results['stages']['initial_analysis'][:500]}
‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å: {results['stages']['solutions_tree'][:500]}
‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á: {results['stages']['reflection'][:500]}
‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡πå: {results['stages']['critique'][:500]}

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà:
1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö
2. ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á
3. ‡∏°‡∏µ action items ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
4. ‡∏°‡∏µ timeline ‡πÅ‡∏•‡∏∞ KPIs
"""
    
    response5 = client.models.generate_content(model=MODEL_NAME, contents=stage5_prompt)
    results["stages"]["final_plan"] = response5.text
    print(response5.text)
    
    # Stage 6: Evaluation
    print("\nüìå Stage 6: LLM-as-a-Judge Evaluation")
    eval_prompt = f"""
‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏ú‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ô‡∏µ‡πâ:
{results['stages']['final_plan']}

‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 1-10 ‡πÉ‡∏ô:
- Feasibility (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ)
- Completeness (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô)
- Practicality (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏ò‡∏£‡∏£‡∏°)
- Innovation (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå)

OVERALL: [score]/10
"""
    
    response6 = client.models.generate_content(model=MODEL_NAME, contents=eval_prompt)
    results["evaluation"] = response6.text
    print(response6.text)
    
    return results

#%%
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Advanced Analysis System
complex_problem = """
‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó Startup ‡∏î‡πâ‡∏≤‡∏ô EdTech ‡∏°‡∏µ‡πÅ‡∏≠‡∏õ e-learning ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 10,000 ‡∏Ñ‡∏ô
‡πÅ‡∏ï‡πà retention rate ‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å (‡πÄ‡∏û‡∏µ‡∏¢‡∏á 15% ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏±‡∏á 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2 ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° retention ‡πÄ‡∏õ‡πá‡∏ô 40% ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
‡∏ó‡∏µ‡∏°‡∏°‡∏µ developer 3 ‡∏Ñ‡∏ô ‡πÅ‡∏•‡∏∞ designer 1 ‡∏Ñ‡∏ô
"""

print("üéØ Running Final Challenge...")
final_results = advanced_analysis_system(complex_problem)

#%% [markdown]
# ---
# # üìù Summary & Cheat Sheet
# 
# ---
# 
# ## ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ:
# 
# | ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ | ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô |
# |--------|---------|------------|
# | Few-shot | ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ format ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ | ‚≠ê |
# | Chain-of-Thought | ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• | ‚≠ê‚≠ê |
# | Self-Consistency | ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à | ‚≠ê‚≠ê‚≠ê |
# | Prompt Chaining | ‡∏á‡∏≤‡∏ô‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô | ‚≠ê‚≠ê‚≠ê |
# | Reflection | ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö | ‚≠ê‚≠ê‚≠ê‚≠ê |
# | Tree-of-Thought | ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
# | Self-Feedback | ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå | ‚≠ê‚≠ê‚≠ê‚≠ê |
# | Self-Critique | ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
# 
# ## Evaluation Methods:
# - **LLM-as-a-Judge**: ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
# - **Reference-free**: ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
# - **Pairwise Comparison**: ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö 2 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

#%% [markdown]
# ---
# # üèÅ End of Lab
# 
# ## üìö ‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:
# - [Google AI Documentation](https://ai.google.dev/)
# - [Prompt Engineering Guide](https://www.promptingguide.ai/)
# - [Chain-of-Thought Paper](https://arxiv.org/abs/2201.11903)
# - [Tree-of-Thought Paper](https://arxiv.org/abs/2305.10601)
# 
# ## ‚úÖ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ:
# 1. ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Prompt Engineering 8 ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ
# 2. ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û LLM output
# 3. ‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
# 
# **Happy Prompting! üéâ**
```

---

## üìã ‡∏™‡∏£‡∏∏‡∏õ Lab Structure

| Part | ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ | ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å | Evaluation |
|------|--------|-------------|------------|
| 1 | Few-shot Prompting | ‚≠ê | - |
| 2 | Chain-of-Thought | ‚≠ê‚≠ê | - |
| 3 | Self-Consistency CoT | ‚≠ê‚≠ê‚≠ê | - |
| 4 | Prompt Chaining | ‚≠ê‚≠ê‚≠ê | - |
| 5 | Reflection | ‚≠ê‚≠ê‚≠ê‚≠ê | - |
| 6 | Tree-of-Thought | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | - |
| 7 | Self-Feedback | ‚≠ê‚≠ê‚≠ê‚≠ê | - |
| 8 | Self-Critique | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | - |
| 9 | Evaluation Methods | ‚≠ê‚≠ê‚≠ê | LLM-as-Judge, Reference-free |
| 10 | Comprehensive Evaluation | ‚≠ê‚≠ê‚≠ê‚≠ê | Combined |
| 11 | Final Challenge | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Full Pipeline |